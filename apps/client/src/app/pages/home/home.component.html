<div style="margin: 1em">
  <h1>{{ messages.header }}</h1>
  @if (deals$ | async; as response) {
    @if (response.loading) {
      <mat-spinner></mat-spinner>
    }
    @if (response.data; as data) {
      <deals-deals-paginator
        (page)="handlePageEvent($event)"
        [totalItems]="data.deals.meta.totalItems || 0"
        [itemsPerPage]="data.deals.meta.itemsPerPage"
        [currentPage]="data.deals.meta.currentPage - 1"
      />
      @if (data) {
        <div class="deals-container">
          @for (deal of data.deals.items; track deal.id) {
            <deals-deal-card
              [dealPrice]="deal.dealPrice"
              [productPrice]="deal.product.price"
              [productImageUrl]="deal.product.imageUrl"
              [productName]="deal.product.name"
              [productUrl]="deal.product.productUrl"
              [dealQuantity]="deal.dealQuantity"
              [shopName]="deal.product.shop.name"
            />
          }
        </div>
        @if(data.deals.items.length) {
          <deals-deals-paginator
            (page)="handlePageEvent($event)"
            [totalItems]="data.deals.meta.totalItems || 0"
            [itemsPerPage]="data.deals.meta.itemsPerPage"
            [currentPage]="data.deals.meta.currentPage - 1"
          />
        }
      }
    }
    @if (response.errors; as error) {
      <p>Could not get deals: {{ error.at(0)?.message }}</p>
    }
  }
</div>
